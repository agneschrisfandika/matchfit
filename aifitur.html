<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fashion Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            border: none;
            background: transparent;
            font-size: 1em;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .feature-section {
            display: none;
        }

        .feature-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .file-upload {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #e7f3ff;
        }

        .file-upload input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            border-left: 5px solid #667eea;
        }

        .result-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .result-item h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .result-item ul {
            margin-left: 20px;
        }

        .result-item li {
            margin: 5px 0;
        }

        .result-item p {
            margin: 8px 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .outfit-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            margin-bottom: 20px;
        }

        .outfit-card:hover {
            transform: translateY(-5px);
        }

        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #cfe2ff;
            color: #084298;
            border: 1px solid #b6d4fe;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® AI Fashion Assistant</h1>
            <p>Analisis Bentuk Tubuh & Rekomendasi Style Powered by Gemini AI</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">üì∏ Body Shape Detector</button>
            <button class="tab" onclick="switchTab(1)">üëó Mix & Match Generator</button>
            <button class="tab" onclick="switchTab(2)">üé≠ Virtual Try-On</button>
        </div>

        <div class="content">
            <!-- FITUR 1: Body Shape Detector -->
            <div class="feature-section active" id="feature1">
                <h2>üîç Analisis Bentuk Tubuh & Warna Kulit</h2>
                
                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Info:</strong> Upload foto seluruh tubuh Anda atau masukkan ukuran manual untuk analisis akurat.
                </div>

                <div class="input-group">
                    <label>Upload Foto Tubuh (Opsional)</label>
                    <div class="file-upload" onclick="document.getElementById('bodyPhoto').click()">
                        <input type="file" id="bodyPhoto" accept="image/*" onchange="previewImage(this, 'bodyPreview')">
                        <p>üì∑ Klik untuk upload foto</p>
                        <small>Format: JPG, PNG (Max 5MB)</small>
                    </div>
                    <img id="bodyPreview" class="preview-image" style="display:none;">
                </div>

                <div class="grid-2">
                    <div class="input-group">
                        <label>Tinggi Badan (cm)</label>
                        <input type="number" id="height" placeholder="Contoh: 165">
                    </div>
                    <div class="input-group">
                        <label>Berat Badan (kg)</label>
                        <input type="number" id="weight" placeholder="Contoh: 55">
                    </div>
                    <div class="input-group">
                        <label>Lingkar Bahu (cm)</label>
                        <input type="number" id="shoulder" placeholder="Contoh: 90">
                    </div>
                    <div class="input-group">
                        <label>Lingkar Pinggang (cm)</label>
                        <input type="number" id="waist" placeholder="Contoh: 70">
                    </div>
                    <div class="input-group">
                        <label>Lingkar Pinggul (cm)</label>
                        <input type="number" id="hip" placeholder="Contoh: 95">
                    </div>
                    <div class="input-group">
                        <label>Warna Kulit</label>
                        <select id="skinTone">
                            <option value="">Pilih warna kulit</option>
                            <option value="very-light">Sangat Terang</option>
                            <option value="light">Terang</option>
                            <option value="medium">Sedang</option>
                            <option value="tan">Sawo Matang</option>
                            <option value="dark">Gelap</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label>Undertone Kulit</label>
                    <select id="undertone">
                        <option value="">Pilih undertone</option>
                        <option value="cool">Cool (Pink/Merah Muda)</option>
                        <option value="warm">Warm (Kuning/Keemasan)</option>
                        <option value="neutral">Neutral (Campuran)</option>
                    </select>
                </div>

                <button class="btn" onclick="analyzeBodyShape()">üöÄ Analisis Sekarang</button>

                <div class="loading" id="loading1">
                    <div class="spinner"></div>
                    <p>Menganalisis dengan AI...</p>
                </div>

                <div id="result1"></div>
            </div>

            <!-- FITUR 2: Mix & Match Generator -->
            <div class="feature-section" id="feature2">
                <h2>üëó Generator Mix & Match Outfit</h2>

                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Perhatian:</strong> Fitur ini memerlukan hasil analisis dari Fitur 1 terlebih dahulu.
                </div>

                <div class="input-group">
                    <label>Acara / Keperluan</label>
                    <select id="occasion">
                        <option value="">Pilih acara</option>
                        <option value="casual">Casual / Santai</option>
                        <option value="formal">Formal / Kantor</option>
                        <option value="party">Pesta / Party</option>
                        <option value="sport">Olahraga</option>
                        <option value="date">Kencan</option>
                        <option value="wedding">Pernikahan</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Gaya Pribadi</label>
                    <select id="style">
                        <option value="">Pilih gaya</option>
                        <option value="minimalist">Minimalis</option>
                        <option value="elegant">Elegan</option>
                        <option value="bohemian">Bohemian</option>
                        <option value="sporty">Sporty</option>
                        <option value="trendy">Trendy</option>
                        <option value="classic">Klasik</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Preferensi Warna (Opsional)</label>
                    <input type="text" id="colorPreference" placeholder="Contoh: biru, hitam, putih">
                </div>

                <button class="btn" onclick="generateOutfit()">‚ú® Generate Outfit</button>

                <div class="loading" id="loading2">
                    <div class="spinner"></div>
                    <p>Membuat kombinasi outfit terbaik...</p>
                </div>

                <div id="result2"></div>
            </div>

            <!-- FITUR 3: Virtual Try-On -->
            <div class="feature-section" id="feature3">
                <h2>üé≠ Virtual Try-On</h2>

                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Info:</strong> Upload foto Anda untuk melihat tampilan outfit secara virtual.
                </div>

                <div class="input-group">
                    <label>Upload Foto Anda</label>
                    <div class="file-upload" onclick="document.getElementById('tryonPhoto').click()">
                        <input type="file" id="tryonPhoto" accept="image/*" onchange="previewImage(this, 'tryonPreview')">
                        <p>üì∑ Klik untuk upload foto</p>
                        <small>Foto menghadap kamera untuk hasil terbaik</small>
                    </div>
                    <img id="tryonPreview" class="preview-image" style="display:none;">
                </div>

                <div class="input-group">
                    <label>Pilih Outfit dari Rekomendasi</label>
                    <select id="outfitChoice">
                        <option value="">Pilih outfit...</option>
                    </select>
                </div>

                <button class="btn" onclick="virtualTryOn()">üé® Coba Virtual</button>

                <div class="loading" id="loading3">
                    <div class="spinner"></div>
                    <p>Memproses virtual try-on...</p>
                </div>

                <div id="result3"></div>
            </div>
        </div>
    </div>

    <script>
  // ‚ö†Ô∏è GANTI API KEY DI BAWAH INI DENGAN API KEY GEMINI ANDA
  const GEMINI_API_KEY = 'AIzaSyA1Aj6rpqxVQt-6OCOPsBXPFUce6C2OfKs';

  let analysisData = null;
  let outfitRecommendations = [];

  function switchTab(index) {
    const tabs = document.querySelectorAll('.tab');
    const sections = document.querySelectorAll('.feature-section');

    tabs.forEach((tab, i) => tab.classList.toggle('active', i === index));
    sections.forEach((section, i) => section.classList.toggle('active', i === index));
  }

  function previewImage(input, previewId) {
    const preview = document.getElementById(previewId);
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(input.files[0]);
    }
  }

  // ‚úÖ WAJIB async (karena memakai await fetch)
  async function callGeminiAPI(prompt) {
    if (!GEMINI_API_KEY || GEMINI_API_KEY === 'AIzaSyA1Aj6rpqxVQt-6OCOPsBXPFUce6C2OfKs') {
  return {
    error: true,
    message: 'Mohon isi API Key Gemini Anda.'
  };
}


    try {
      const MODEL = "gemini-1.5-flash";
const response = await fetch(
  `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${GEMINI_API_KEY}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: {
              temperature: 0.9,
              topK: 40,
              topP: 0.95,
              maxOutputTokens: 2048,
            },
          }),
        }
      );

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData?.error?.message || `HTTP error! status: ${response.status}`);
      }

      const data = await response.json();

      if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
        return { error: false, text: data.candidates[0].content.parts[0].text };
      }

      return { error: true, message: 'Tidak ada respons dari AI. Coba lagi.' };
    } catch (error) {
      console.error('API Error:', error);
      return { error: true, message: 'Error: ' + error.message };
    }
  }

  async function analyzeBodyShape() {
    const height = document.getElementById('height').value;
    const weight = document.getElementById('weight').value;
    const shoulder = document.getElementById('shoulder').value;
    const waist = document.getElementById('waist').value;
    const hip = document.getElementById('hip').value;
    const skinTone = document.getElementById('skinTone').value;
    const undertone = document.getElementById('undertone').value;

    if (!height || !weight || !shoulder || !waist || !hip || !skinTone || !undertone) {
      alert('Mohon lengkapi semua data!');
      return;
    }

    const loading = document.getElementById('loading1');
    const resultDiv = document.getElementById('result1');

    loading.classList.add('active');
    resultDiv.innerHTML = '';

    const prompt = `Kamu adalah fashion expert dan body shape analyst profesional. Analisis data berikut dan berikan output dalam format JSON yang VALID:

Data Pengukuran:
- Tinggi: ${height} cm
- Berat: ${weight} kg
- Lingkar Bahu: ${shoulder} cm
- Lingkar Pinggang: ${waist} cm
- Lingkar Pinggul: ${hip} cm
- Warna Kulit: ${skinTone}
- Undertone: ${undertone}

Berikan analisis HANYA dalam format JSON berikut (tanpa teks tambahan, tanpa markdown):
{
  "bodyShape": "rectangle",
  "bodyShapeDescription": "Deskripsi bentuk tubuh ini secara detail",
  "strengths": ["Kelebihan 1", "Kelebihan 2", "Kelebihan 3"],
  "recommendations": {
    "dos": ["Yang harus dilakukan 1", "Yang harus dilakukan 2", "Yang harus dilakukan 3"],
    "donts": ["Yang harus dihindari 1", "Yang harus dihindari 2", "Yang harus dihindari 3"]
  },
  "colorAnalysis": {
    "bestColors": ["Warna 1", "Warna 2", "Warna 3", "Warna 4", "Warna 5"],
    "avoidColors": ["Warna yang dihindari 1", "Warna 2", "Warna 3"],
    "reasoning": "Penjelasan mengapa warna tersebut cocok"
  },
  "clothingStyles": ["Style 1", "Style 2", "Style 3"],
  "fabricRecommendations": ["Fabric 1", "Fabric 2", "Fabric 3"]
}`;

    const result = await callGeminiAPI(prompt);
    loading.classList.remove('active');

    if (result.error) {
      resultDiv.innerHTML = `<div class="alert alert-danger"><strong>‚ùå Error:</strong> ${result.message}</div>`;
      return;
    }

    try {
      let jsonText = result.text.trim();
      jsonText = jsonText.replace(/```json/g, '').replace(/```/g, '').trim();

      const analysis = JSON.parse(jsonText);
      analysisData = analysis;

      resultDiv.innerHTML = `
        <div class="result-box">
          <h3>üìä Hasil Analisis</h3>

          <div class="result-item">
            <h4>üî∑ Bentuk Tubuh: ${(analysis.bodyShape || '').toUpperCase()}</h4>
            <p>${analysis.bodyShapeDescription || '-'}</p>
          </div>

          <div class="result-item">
            <h4>üí™ Kelebihan Bentuk Tubuh Anda:</h4>
            <ul>${(analysis.strengths || []).map(s => `<li>${s}</li>`).join('')}</ul>
          </div>

          <div class="result-item">
            <h4>‚úÖ Yang Harus Dilakukan:</h4>
            <ul>${(analysis?.recommendations?.dos || []).map(d => `<li>${d}</li>`).join('')}</ul>
          </div>

          <div class="result-item">
            <h4>‚ùå Yang Harus Dihindari:</h4>
            <ul>${(analysis?.recommendations?.donts || []).map(d => `<li>${d}</li>`).join('')}</ul>
          </div>

          <div class="result-item">
            <h4>üé® Analisis Warna:</h4>
            <p><strong>Warna Terbaik:</strong> ${(analysis?.colorAnalysis?.bestColors || []).join(', ')}</p>
            <p><strong>Warna yang Dihindari:</strong> ${(analysis?.colorAnalysis?.avoidColors || []).join(', ')}</p>
            <p><strong>Alasan:</strong> ${analysis?.colorAnalysis?.reasoning || '-'}</p>
          </div>

          <div class="result-item">
            <h4>üëó Gaya Pakaian yang Cocok:</h4>
            <p>${(analysis.clothingStyles || []).join(', ')}</p>
          </div>

          <div class="result-item">
            <h4>üßµ Rekomendasi Bahan:</h4>
            <p>${(analysis.fabricRecommendations || []).join(', ')}</p>
          </div>

          <div class="alert alert-success">
            <strong>‚úÖ Analisis Berhasil!</strong> Silakan lanjut ke tab "Mix & Match Generator" untuk mendapatkan rekomendasi outfit.
          </div>
        </div>
      `;
    } catch (e) {
      console.error('Parse error:', e);
      console.log('Response text:', result.text);
      resultDiv.innerHTML = `<div class="alert alert-danger">
        <strong>‚ùå Error parsing JSON:</strong> ${e.message}<br>
        <small>Response dari API: ${String(result.text).substring(0, 300)}...</small>
      </div>`;
    }
  }

  async function generateOutfit() {
    if (!analysisData) {
      alert('Mohon lakukan analisis bentuk tubuh terlebih dahulu di Fitur 1!');
      switchTab(0);
      return;
    }

    const occasion = document.getElementById('occasion').value;
    const style = document.getElementById('style').value;
    const colorPref = document.getElementById('colorPreference').value;

    if (!occasion || !style) {
      alert('Mohon pilih acara dan gaya!');
      return;
    }

    const loading = document.getElementById('loading2');
    const resultDiv = document.getElementById('result2');

    loading.classList.add('active');
    resultDiv.innerHTML = '';

    const prompt = `Kamu adalah fashion stylist expert profesional. Buatkan 3 kombinasi outfit lengkap berdasarkan data berikut:

Bentuk Tubuh: ${analysisData.bodyShape}
Warna Terbaik: ${(analysisData?.colorAnalysis?.bestColors || []).join(', ')}
Acara: ${occasion}
Gaya Pribadi: ${style}
${colorPref ? `Preferensi Warna: ${colorPref}` : ''}

Berikan HANYA dalam format JSON (tanpa teks tambahan, tanpa markdown):
{
  "outfits": [
    {
      "name": "Nama Outfit 1",
      "description": "Deskripsi singkat outfit",
      "top": "Detail atasan lengkap",
      "bottom": "Detail bawahan lengkap",
      "shoes": "Detail sepatu lengkap",
      "accessories": ["Aksesoris 1", "Aksesoris 2"],
      "colors": ["Warna 1", "Warna 2"],
      "occasion": "Kapan cocok dipakai",
      "tips": "Tips styling"
    },
    {
      "name": "Nama Outfit 2",
      "description": "Deskripsi singkat outfit",
      "top": "Detail atasan lengkap",
      "bottom": "Detail bawahan lengkap",
      "shoes": "Detail sepatu lengkap",
      "accessories": ["Aksesoris 1", "Aksesoris 2"],
      "colors": ["Warna 1", "Warna 2"],
      "occasion": "Kapan cocok dipakai",
      "tips": "Tips styling"
    },
    {
      "name": "Nama Outfit 3",
      "description": "Deskripsi singkat outfit",
      "top": "Detail atasan lengkap",
      "bottom": "Detail bawahan lengkap",
      "shoes": "Detail sepatu lengkap",
      "accessories": ["Aksesoris 1", "Aksesoris 2"],
      "colors": ["Warna 1", "Warna 2"],
      "occasion": "Kapan cocok dipakai",
      "tips": "Tips styling"
    }
  ]
}`;

    const result = await callGeminiAPI(prompt);
    loading.classList.remove('active');

    if (result.error) {
      resultDiv.innerHTML = `<div class="alert alert-danger"><strong>‚ùå Error:</strong> ${result.message}</div>`;
      return;
    }

    try {
      let jsonText = result.text.trim();
      jsonText = jsonText.replace(/```json/g, '').replace(/```/g, '').trim();

      const data = JSON.parse(jsonText);
      outfitRecommendations = data.outfits || [];

      // Isi dropdown Outfit Choice untuk Virtual Try-On
      const outfitSelect = document.getElementById('outfitChoice');
      outfitSelect.innerHTML =
        '<option value="">Pilih outfit...</option>' +
        outfitRecommendations.map((o, i) => `<option value="${i}">${o.name}</option>`).join('');

      resultDiv.innerHTML = `
        <div class="result-box">
          <h3>‚ú® Rekomendasi Outfit Anda</h3>
          ${outfitRecommendations
            .map(
              (outfit) => `
              <div class="outfit-card">
                <h4>üëó ${outfit.name}</h4>
                <p><em>${outfit.description || ''}</em></p>
                <p><strong>üëö Atasan:</strong> ${outfit.top}</p>
                <p><strong>üëñ Bawahan:</strong> ${outfit.bottom}</p>
                <p><strong>üëû Sepatu:</strong> ${outfit.shoes}</p>
                <p><strong>üíç Aksesoris:</strong> ${(outfit.accessories || []).join(', ')}</p>
                <p><strong>üé® Warna:</strong> ${(outfit.colors || []).join(', ')}</p>
                <p><strong>üìÖ Cocok untuk:</strong> ${outfit.occasion}</p>
                <p><strong>üí° Tips:</strong> ${outfit.tips}</p>
              </div>
            `
            )
            .join('')}
          <div class="alert alert-success">
            <strong>‚úÖ Outfit Generated!</strong> Silakan lanjut ke tab "Virtual Try-On" untuk visualisasi.
          </div>
        </div>
      `;
    } catch (e) {
      console.error('Parse error:', e);
      console.log('Response text:', result.text);
      resultDiv.innerHTML = `<div class="alert alert-danger">
        <strong>‚ùå Error parsing JSON:</strong> ${e.message}<br>
        <small>Response dari API: ${String(result.text).substring(0, 300)}...</small>
      </div>`;
    }
  }

  async function virtualTryOn() {
    const photo = document.getElementById('tryonPhoto').files[0];
    const outfitIndex = document.getElementById('outfitChoice').value;

    if (!photo) {
      alert('Mohon upload foto Anda!');
      return;
    }

    if (outfitIndex === '') {
      alert('Mohon pilih outfit dari rekomendasi!');
      return;
    }

    if (outfitRecommendations.length === 0) {
      alert('Mohon generate outfit terlebih dahulu di Fitur 2!');
      switchTab(1);
      return;
    }

    const loading = document.getElementById('loading3');
    const resultDiv = document.getElementById('result3');

    loading.classList.add('active');
    resultDiv.innerHTML = '';

    const selectedOutfit = outfitRecommendations[outfitIndex];

    const prompt = `Kamu adalah fashion visualization expert. Berikan deskripsi detail visual tentang bagaimana outfit berikut akan terlihat pada seseorang:

Outfit: ${selectedOutfit.name}
- Atasan: ${selectedOutfit.top}
- Bawahan: ${selectedOutfit.bottom}
- Sepatu: ${selectedOutfit.shoes}
- Aksesoris: ${(selectedOutfit.accessories || []).join(', ')}
- Warna: ${(selectedOutfit.colors || []).join(', ')}

Berikan HANYA dalam format JSON (tanpa teks tambahan, tanpa markdown):
{
  "visualization": "Deskripsi detail tampilan keseluruhan outfit pada tubuh",
  "proportions": "Bagaimana proporsi dan fit outfit terlihat",
  "colorHarmony": "Analisis harmoni warna pada tubuh",
  "stylingTips": ["Styling tip 1", "Styling tip 2", "Styling tip 3"],
  "adjustments": ["Saran penyesuaian jika perlu 1", "Saran 2"]
}`;

    const result = await callGeminiAPI(prompt);
    loading.classList.remove('active');

    if (result.error) {
      resultDiv.innerHTML = `<div class="alert alert-danger"><strong>‚ùå Error:</strong> ${result.message}</div>`;
      return;
    }

    try {
      let jsonText = result.text.trim();
      jsonText = jsonText.replace(/```json/g, '').replace(/```/g, '').trim();

      const visual = JSON.parse(jsonText);

      resultDiv.innerHTML = `
        <div class="result-box">
          <h3>üé≠ Hasil Virtual Try-On</h3>

          <div class="result-item">
            <h4>Outfit: ${selectedOutfit.name}</h4>
            <img src="${document.getElementById('tryonPreview').src}" class="preview-image">
          </div>

          <div class="result-item">
            <h4>üëÅÔ∏è Visualisasi Tampilan:</h4>
            <p>${visual.visualization}</p>
          </div>

          <div class="result-item">
            <h4>üìè Proporsi & Fit:</h4>
            <p>${visual.proportions}</p>
          </div>

          <div class="result-item">
            <h4>üé® Harmoni Warna:</h4>
            <p>${visual.colorHarmony}</p>
          </div>

          <div class="result-item">
            <h4>üí° Tips Styling:</h4>
            <ul>${(visual.stylingTips || []).map(t => `<li>${t}</li>`).join('')}</ul>
          </div>

          ${
            visual.adjustments && visual.adjustments.length > 0
              ? `
            <div class="result-item">
              <h4>üîß Saran Penyesuaian:</h4>
              <ul>${visual.adjustments.map(a => `<li>${a}</li>`).join('')}</ul>
            </div>
          `
              : ''
          }

          <div class="alert alert-success">
            <strong>‚úÖ Virtual Try-On Selesai!</strong> Anda dapat mencoba outfit lain atau kembali untuk analisis baru.
          </div>
        </div>
      `;
    } catch (e) {
      console.error('Parse error:', e);
      console.log('Response text:', result.text);
      resultDiv.innerHTML = `<div class="alert alert-danger">
        <strong>‚ùå Error parsing JSON:</strong> ${e.message}<br>
        <small>Response dari API: ${String(result.text).substring(0, 300)}...</small>
      </div>`;
    }
  }
</script>

</body>
</html> 

